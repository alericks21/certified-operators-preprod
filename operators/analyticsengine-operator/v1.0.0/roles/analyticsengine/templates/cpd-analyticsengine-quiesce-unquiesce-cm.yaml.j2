apiVersion: v1
kind: ConfigMap
metadata:
  name: cpd-{{ app }}-aux-qu-cm
  labels:
    app.kubernetes.io/name: {{ app }}-aux-qu
    cpdfwk.aux-kind: qu
    cpdfwk.component: {{ app }}-qu
    cpdfwk.managed-by: ibm-cpd-sre
    cpdfwk.module: {{ app }}-aux-qu
    cpdfwk.name: cpd-{{ app }}-aux-qu-cm
    cpdfwk.vendor: ibm
    cpdfwk.version: 1.0.0
{% if cpdLabels  %} 
    {{ cpdLabels | to_nice_yaml| indent(4) }}
{% endif %}
{% if owner_reference is defined %}
  ownerReferences:
    {{ owner_reference | to_nice_yaml | indent(4) }}
{% endif %}
data:
  aux-meta: |-
    name: {{ app }}-aux
    description: This is quiesce auxiliary meta for {{ app }}
    version: 1.0.0
    component: {{ app }}
    aux-kind: qu
    support-instances: true
    priority-order: 10000
    managed-resources:
  quiesce-meta: |-
    pre-hooks:
      exec-rules:
{% if ansible_operator_meta.name is defined %}
      - resource-kind: analyticsengine.ae.cpd.ibm.com
        name: {{ ansible_operator_meta.name }}
        on-error: Propagate
        actions:
        - builtins:
            name: cpdbr.cpd.ibm.com/enable-maint
            params:
                statusFieldName: analyticsengineStatus
            timeout: 360s
{% endif %}
    unquiesce-meta: |-
      exec-rules:
{% if ansible_operator_meta.name is defined %}
      - resource-kind: analyticsengine.ae.cpd.ibm.com
        name: {{ ansible_operator_meta.name }}
        on-error: Propagate
        actions:
        - builtins:
            name: cpdbr.cpd.ibm.com/disable-maint
            params:
                statusFieldName: analyticsengineStatus
            timeout: 360s
{% endif %}