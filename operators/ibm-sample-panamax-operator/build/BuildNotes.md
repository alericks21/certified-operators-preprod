## Added post-processor (goLang based) to fixup things that are not automatically generated by kubebuilder/sdk tooling

You will need to build the post-processor using:
`make buildPostProcessor`

1. add relatedImages (used file called relatedImages.csv in the cmd/post-processor directory)
2. make sure all alm-examples have a "status: {}" block
3. make sure webhook ports are setup correctly
4. make sure panamax crd has accept enum and required elements setup correctly

post-processor is called in the `make bundle`

TODO: need to change operator image references from the version your building to their digest

## Steps used to cleanup 
```
oc delete ns <ns>
oc delete catalogsource.operators.coreos.com/ibm-sample-panamax-catalog -nopenshift-marketplace
oc get validatingwebhookconfigurations | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete validatingwebhookconfigurations {}  
oc get mutatingwebhookconfigurations | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete mutatingwebhookconfigurations {}  
oc get clusterrolebindings | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete  clusterrolebindings {}  -
oc get clusterroles | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete clusterroles {}  
oc get scc | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete scc {} 
oc get crd | grep panamax | cut -d' ' -f1 | xargs -I {} oc delete crd {}
```

## Your cluster must be setup to use our imagecontentsourcepolicy

//update the global image pull secret with a valid .dockerconfigjson file, here is a sample:

```
oc extract secret/pull-secret -n openshift-config --to=.
```

```
{
    "auths": {
        "cloud.openshift.com": {
            "auth": "<your key>",
            "email": "<valid email>"
        },
        "registry.connect.redhat.com": {
            "auth": "<your key>",
            "email": "<valid email>"
        },
        "registry.redhat.io": {
            "auth": "<your key>",
            "email": "<valid email>"
        },
        "cp.stg.icr.io": {
            "auth": "<your key>",
            "email": "<valid email>"
        },
        "cp.icr.io": {
            "auth": "<your key>",
            "email": "<valid email>"
        }
    }
}
```

### Make sure its formatted as one line
```
jq -c . secret.json > .dockerconfigjson
```


### Apply updates global secret

Note: This is a very disruptive operation, each worker node will be drained and restarted!!!
```
oc set data secret/pull-secret -n openshift-config --from-file=.dockerconfigjson=.dockerconfigjson
```

### Apply the imagecontentsourcepolicy

Note: This is a very disruptive operation, each worker node will be drained and restarted!!!

```
cat <<EOF | oc apply -f -
apiVersion: operator.openshift.io/v1alpha1
kind: ImageContentSourcePolicy
metadata:
  name: mirror-config
spec:
  repositoryDigestMirrors:
  - mirrors:
    - cp.stg.icr.io/cp
    source: cp.icr.io/cp
  - mirrors:
    - cp.stg.icr.io/cp
    source: icr.io/cpopen    
EOF    
```

## Use the cp.stg.icr.io/cp repo for all pre-ga public images
You will need to have a valid cp.stg.icr.io apikey!!

## YOU MUST SET THE CP_CREDS env var prior to running make targets the interact with cp.stg.icr.io/cp!!
```
export CP_CREDS=<iamakikey:yourKey>
```

